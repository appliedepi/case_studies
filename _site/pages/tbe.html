<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Epi Open Case Study Repository – tbe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="webex.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Applied Epi Open Case Study Repository</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/instructions.html" rel="" target="">
 <span class="menu-text">How-to Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../pages/instructions.html" rel="" target="">
 <span class="menu-text">About Applied Epi</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://twitter.com/appliedepi" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/company/appliedepi/" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logos/Applied_Epi_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tbe---linear-regression-eng" id="toc-tbe---linear-regression-eng" class="nav-link active" data-scroll-target="#tbe---linear-regression-eng">TBE - Linear regression (ENG)</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#instructions" id="toc-instructions" class="nav-link" data-scroll-target="#instructions">Instructions</a>
  <ul class="collapse">
  <li><a href="#getting-help" id="toc-getting-help" class="nav-link" data-scroll-target="#getting-help">Getting Help</a></li>
  <li><a href="#hints-and-solutions" id="toc-hints-and-solutions" class="nav-link" data-scroll-target="#hints-and-solutions">Hints and Solutions</a></li>
  <li><a href="#feedback-suggestions" id="toc-feedback-suggestions" class="nav-link" data-scroll-target="#feedback-suggestions">Feedback &amp; suggestions</a></li>
  <li><a href="#version-and-revisions" id="toc-version-and-revisions" class="nav-link" data-scroll-target="#version-and-revisions">Version and revisions</a></li>
  </ul></li>
  <li><a href="#guidance" id="toc-guidance" class="nav-link" data-scroll-target="#guidance">Guidance</a>
  <ul class="collapse">
  <li><a href="#objectives-of-this-case-study" id="toc-objectives-of-this-case-study" class="nav-link" data-scroll-target="#objectives-of-this-case-study">Objectives of this case study</a></li>
  <li><a href="#previous-level-of-expertise-assumed" id="toc-previous-level-of-expertise-assumed" class="nav-link" data-scroll-target="#previous-level-of-expertise-assumed">Previous level of expertise assumed</a></li>
  <li><a href="#preparation-for-the-case-study" id="toc-preparation-for-the-case-study" class="nav-link" data-scroll-target="#preparation-for-the-case-study">Preparation for the case study</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#introduction-to-the-case-study" id="toc-introduction-to-the-case-study" class="nav-link" data-scroll-target="#introduction-to-the-case-study">Introduction to the case study</a></li>
  <li><a href="#overall-goal" id="toc-overall-goal" class="nav-link" data-scroll-target="#overall-goal">Overall goal</a>
  <ul class="collapse">
  <li><a href="#goal-1-draw-a-directed-acyclic-graph-dag" id="toc-goal-1-draw-a-directed-acyclic-graph-dag" class="nav-link" data-scroll-target="#goal-1-draw-a-directed-acyclic-graph-dag"><strong>Goal 1: Draw a Directed Acyclic Graph (DAG)</strong></a></li>
  <li><a href="#goal-2-perform-linear-regression-in-r" id="toc-goal-2-perform-linear-regression-in-r" class="nav-link" data-scroll-target="#goal-2-perform-linear-regression-in-r"><strong>Goal 2: Perform linear regression in R</strong></a>
  <ul class="collapse">
  <li><a href="#step-1-set-up" id="toc-step-1-set-up" class="nav-link" data-scroll-target="#step-1-set-up"><strong>Step 1: Set up</strong></a></li>
  <li><a href="#step-2-import-and-explore-data" id="toc-step-2-import-and-explore-data" class="nav-link" data-scroll-target="#step-2-import-and-explore-data"><strong>Step 2: Import and explore data</strong></a></li>
  <li><a href="#step-3-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-age" id="toc-step-3-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-age" class="nav-link" data-scroll-target="#step-3-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-age"><strong>Step 3: Check if there is a linear association between length of hospitalisation and age</strong></a></li>
  <li><a href="#step-4-check-if-there-is-a-difference-in-length-of-hospitalisation-by-hypertension-status" id="toc-step-4-check-if-there-is-a-difference-in-length-of-hospitalisation-by-hypertension-status" class="nav-link" data-scroll-target="#step-4-check-if-there-is-a-difference-in-length-of-hospitalisation-by-hypertension-status"><strong>Step 4: Check if there is a difference in length of hospitalisation by hypertension status</strong></a></li>
  <li><a href="#step-5-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-the-rest-of-variables" id="toc-step-5-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-the-rest-of-variables" class="nav-link" data-scroll-target="#step-5-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-the-rest-of-variables"><strong>Step 5: Check if there is a linear association between length of hospitalisation and the rest of variables</strong></a></li>
  <li><a href="#step-6-multivariable-analysis" id="toc-step-6-multivariable-analysis" class="nav-link" data-scroll-target="#step-6-multivariable-analysis"><strong>Step 6: Multivariable analysis</strong></a></li>
  <li><a href="#step-7-model-diagnostics" id="toc-step-7-model-diagnostics" class="nav-link" data-scroll-target="#step-7-model-diagnostics"><strong>Step 7: Model diagnostics</strong></a></li>
  <li><a href="#step-8-public-health-relevance" id="toc-step-8-public-health-relevance" class="nav-link" data-scroll-target="#step-8-public-health-relevance"><strong>Step 8: Public health relevance</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<!-- Some considerations about about this quarto template 
-   Text within \<! \> will not show in your final document.
    -   The other parts such as slashes (///), dashes (-) and tildes (\~) are just aesthetic
    -   These comments are used to explain the code chunks.\
    -   We refer to functions in curly brackets, e.g. {dplyr} and functions end in brackets, e.g. count()\
    -   This comment will not show up when you knit the document.\
    -   You can delete them if you want.\ -->
<!--Below insert the name of the Case study. In curly brackets is the section reference name to be cross-references throughout the book -->
<section id="tbe---linear-regression-eng" class="level1 unnumbered">
<h1 class="unnumbered">TBE - Linear regression (ENG)</h1>
<section id="overview" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="overview">Overview</h2>
<table class="table">
<thead>
<tr class="header">
<th><strong>Case study characteristics</strong></th>
<th style="text-align: left;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Name:</td>
<td style="text-align: left;">TBE - linear regression</td>
</tr>
<tr class="even">
<td>Language:</td>
<td style="text-align: left;">English</td>
</tr>
<tr class="odd">
<td>Tool:</td>
<td style="text-align: left;">R; DAGitty</td>
</tr>
<tr class="even">
<td>Location:</td>
<td style="text-align: left;">Germany</td>
</tr>
<tr class="odd">
<td>Scale:</td>
<td style="text-align: left;">National</td>
</tr>
<tr class="even">
<td>Diseases:</td>
<td style="text-align: left;">TBE</td>
</tr>
<tr class="odd">
<td>Keywords:</td>
<td style="text-align: left;">TBE; Linear Regression; R</td>
</tr>
<tr class="even">
<td>Technical complexity:</td>
<td style="text-align: left;">Intermediate</td>
</tr>
<tr class="odd">
<td>Methodological complexity:</td>
<td style="text-align: left;">Intermediate</td>
</tr>
</tbody>
</table>
<p><strong><em>Authorship</em></strong><br>
Original authors: Teresa Nygren (RKI), Alicia Barrasa Blanco (UK FETP), Jan Walter (RKI) and Achim Dörre (RKI)<br>
Data source: Data is fictional and was inspired by <a href="https://linkinghub.elsevier.com/retrieve/pii/S0163-4453(23)00088-9">Nygren et al.&nbsp;Tick-borne encephalitis: acute clinical manifestations and severity in 581 cases from Germany, 2018-2020. Journal of Infection. 2023 Apr 1;86(4):369-75</a><br>
Adapted by: Liese Van Gompel (MediPIET), Joana Gomes Dias (ECDC), Chiara Entradi (ECDC) and Alberto Mateo Urdiales (ISS)<br>
</p>
</section>
<section id="instructions" class="level2">
<h2 class="anchored" data-anchor-id="instructions">Instructions</h2>
<section id="getting-help" class="level3">
<h3 class="anchored" data-anchor-id="getting-help">Getting Help</h3>
<p>There are several ways to get help:</p>
<ol type="1">
<li>Look for the “hints” and solutions (see below)</li>
<li>Post a question in <a href="www.community.appliedepi.org">Applied Epi Community</a> with reference to this case study</li>
</ol>
</section>
<section id="hints-and-solutions" class="level3">
<h3 class="anchored" data-anchor-id="hints-and-solutions">Hints and Solutions</h3>
<p>Here is what the “helpers” look like:</p>
<!--Note that this is the way of including hints and explanations to the solutions -->
<!--
NOTE: Below is the hint (all within details tags collapsed)
-->
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>Here you will see a helpful hint!</p>
<p><br></p>
</details>
<!--
NOTE: Below is the solution (all within details tags collapsed)
-->
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the solution</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ebola_linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;</span> <span class="dv">25</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    district <span class="sc">==</span> <span class="st">"Bolo"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is more explanation about why the solution works.</p>
<p><br></p>
</details>
<!--
NOTE: End of solution
-->
<!-- NOTE ABOUT SOLUTIONS: When using {webexercises} the solution will be automatically highlighted, so you can change (if appropriate) the feature "Click here to see the solution" to  "Click here to see the explanation of the solution" -->
<section id="posting-a-question-in-the-community-forum" class="level4">
<h4 class="anchored" data-anchor-id="posting-a-question-in-the-community-forum">Posting a question in the Community Forum</h4>
<p>… description here about posting in Community… TO BE COMPLETED BY APPLIED EPI</p>
</section>
<section id="terms-of-use" class="level4">
<h4 class="anchored" data-anchor-id="terms-of-use">Terms of Use</h4>
<p><strong>Disclaimer</strong>: The information presented in this exercise and the associated data files have been deliberately changed so as to facilitate the acquisition of the learning objectives for fellows of EPIET, EUPHEM and EPIET-associated programmes. This case study was first introduced in 2022 (see Copyright and Licence agreement for more information).</p>
<p>You are free:</p>
<ul>
<li>to Share: to copy and distribute the work</li>
<li>to Remix: to adapt and build upon the material</li>
</ul>
<p>Under the following conditions:</p>
<ul>
<li><p>Attribution: You must attribute the work in the manner specified by the author or licensor (but not in any way that suggests that they endorse you or your use of the work). The best way to do this is to keep as it is the list of contributors: sources, authors and reviewers.</p></li>
<li><p>Share Alike: If you alter, transform, or build upon this work, you may distribute the resulting work only under the same or similar license to this one. Your changes must be documented. Under that condition, you are allowed to add your name to the list of contributors.</p></li>
<li><p>Notification: If you use the work in the manner specified by the author or licensor, <a href="mailto:Walterj@rki.de">Walter@rki.de</a></p></li>
<li><p>You cannot sell this work alone but you can use it as part of a teaching.</p></li>
</ul>
<p>With the understanding that:</p>
<ul>
<li><p>Waiver: Any of the above conditions can be waived if you get permission from the copyright holder.</p></li>
<li><p>Public Domain: Where the work or any of its elements is in the public domain under applicable law, that status is in no way affected by the license.</p></li>
<li><p>Other Rights: In no way are any of the following rights affected by the license:</p>
<ul>
<li><p>Your fair dealing or fair use rights, or other applicable copyright exceptions and limitations;</p></li>
<li><p>The author’s moral rights;</p></li>
<li><p>Rights other persons may have either in the work itself or in how the work is used, such as publicity or privacy rights.</p></li>
</ul></li>
<li><p>Notice: For any reuse or distribution, you must make clear to others the license terms of this work by keeping together this work and the current license.</p></li>
</ul>
<p>This licence is based on <a href="http://creativecommons.org/licenses/by-sa/3.0/" class="uri">http://creativecommons.org/licenses/by-sa/3.0/</a></p>
</section>
</section>
<section id="feedback-suggestions" class="level3">
<h3 class="anchored" data-anchor-id="feedback-suggestions">Feedback &amp; suggestions</h3>
<ul>
<li>You can write feedback and suggestions on this case study at the <a href="https://github.com/appliedepi/case_studies">GitHub issues page</a></li>
<li>Alternatively email us at: <a href="mailto:contact@appliedepi.org">contact@appliedepi.org</a></li>
</ul>
<div style="page-break-after: always;"></div>
</section>
<section id="version-and-revisions" class="level3">
<h3 class="anchored" data-anchor-id="version-and-revisions">Version and revisions</h3>
<p>Write date of first version</p>
<p>Write any revisions made to the case study</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 44%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th style="text-align: left;">Changes made</th>
<th style="text-align: right;">Author</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2023</td>
<td style="text-align: left;">Revision R code</td>
<td style="text-align: right;">Liese Van Gompel (MediPIET)</td>
</tr>
<tr class="even">
<td>2024</td>
<td style="text-align: left;">Revision R code</td>
<td style="text-align: right;">Joana Gomes Dias and Chiara Entradi (ECDC)</td>
</tr>
<tr class="odd">
<td>2024</td>
<td style="text-align: left;">Revision of content, structure, R code and adaptation of format to Applied Epi’s template of case studies</td>
<td style="text-align: right;">Alberto Mateo Urdiales (ISS)</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</section>
</section>
<section id="guidance" class="level2">
<h2 class="anchored" data-anchor-id="guidance">Guidance</h2>
<section id="objectives-of-this-case-study" class="level3">
<h3 class="anchored" data-anchor-id="objectives-of-this-case-study">Objectives of this case study</h3>
<p>At the end of the case study, participants should be able to:</p>
<ul>
<li>Use directed acyclic graphs (DAG) to identify variables suitable to control for confounding;</li>
<li>To perform linear regression in R;</li>
<li>To write down the associated models and interpret them.</li>
</ul>
</section>
<section id="previous-level-of-expertise-assumed" class="level3">
<h3 class="anchored" data-anchor-id="previous-level-of-expertise-assumed">Previous level of expertise assumed</h3>
<p>Participants are expected to be familiar with directed acyclic graphs (DAGs) and the use of DAGitty (a browser-based environment for creating DAGS) for the first part; and with data management as well as descriptive and stratified analysis in R for the second part.</p>
</section>
<section id="preparation-for-the-case-study" class="level3">
<h3 class="anchored" data-anchor-id="preparation-for-the-case-study">Preparation for the case study</h3>
<p>Include the steps needed to start replicating the analysis of the case study</p>
<p>For example:</p>
<ol type="1">
<li><p>Download folder named tbe_en and extract contents in the local laptop</p></li>
<li><p>Create an Rstudio project in the folder tbe_en. If you are unsure on how to do that, read the EpiRhandbook Chapter on <a href="https://epirhandbook.com/en/new_pages/r_projects.html">R projects</a></p></li>
<li><p>Inside the folder “tbe_en”: Subfolder “data” contains a raw data file named <em>tbe.RDS</em>. This is the only data file you will use in this case study.</p></li>
<li><p>Subfolder scripts should be used to save any scripts related to the analysis. Inside “backup” you will find a solution script with the code of the case study named <em>tbe_lr_backup.R</em>. You will also find an image which corresponds to the proposed DAG solution.</p></li>
<li><p>Subfolder “outputs” could be used to store all outputs (tables, graphs, documents) that are the result of the analysis</p></li>
<li><p>You will also find inside “tbe_en” a word document called <em>starter_guide_DAGitty.docx</em> in case you need help using this website</p></li>
</ol>
</section>
</section>
</section>
<section id="introduction-to-the-case-study" class="level1">
<h1>Introduction to the case study</h1>
<p>Tick-borne encephalitis (TBE) is a vaccine-preventable, tick-borne viral infection. The typical disease course is biphasic, consisting of a first phase with general symptoms such as headache and fever, a symptom-free interval, and a second phase with neurological manifestations. Severity ranges from mild symptoms over meningitis to severe meningoencephalitis or -myelitis. Overall, 70–95% of infections remain sub-clinical and &lt;1% die. Age, monophasic course, central nervous system (CNS) comorbidities, and general comorbidities were found to be independently associated with severe TBE in some analysis. Results were inconsistent regarding diabetes, male sex and other factors. Further possible predictors include blood type, ticks’ blood meal duration (proxy: large tick at removal), immunosuppression, autoimmune diseases, and chronic inflammatory comorbidities. In Germany, laboratory diagnosis of acute TBE became statutorily notifiable in 2001. From 2018-2020, intensified surveillance was conducted. Primary aims were to assess clinical manifestations, health care utilisation, informal care, treatment practices, quality of life, and sick leave, as well as to identify factors associated with TBE severity</p>
<p><strong>Note</strong>: This introduction has been adapted from <a href="https://linkinghub.elsevier.com/retrieve/pii/S0163-4453(23)00088-9">Nygren et al.&nbsp;Tick-borne encephalitis: acute clinical manifestations and severity in 581 cases from Germany, 2018-2020. Journal of Infection. 2023 Apr 1;86(4):369-75</a></p>
</section>
<section id="overall-goal" class="level1">
<h1>Overall goal</h1>
<p>You are one of the epidemiologists in charge of the intensified surveillance system. Your boss asks you to test a hypothesis that <strong>high blood pressure may also be causal for severe TBE</strong>. As proxy for severe TBE, you will use the length of hospitalisation (number of days spent in hospital).</p>
<section id="goal-1-draw-a-directed-acyclic-graph-dag" class="level2">
<h2 class="anchored" data-anchor-id="goal-1-draw-a-directed-acyclic-graph-dag"><strong>Goal 1: Draw a Directed Acyclic Graph (DAG)</strong></h2>
<p>Since you are interested in a causal question, please draw a DAG. If you want to use a computer, you may try <a href="http://www.dagitty.net/">http://www.dagitty.net/</a>.</p>
<ul>
<li>Which variables would you need to adjust for?</li>
</ul>
<p>If you are new to DAGitty you can find a few helpful information in the document called <em>starter_guide_DAGitty.docx</em> present in the “tbe_en” folder you have downloaded in your laptop (See <strong>Preparation for the case study</strong>).</p>
<p>Once you have drawn your DAG, click on the solution below to see the DAG we propose.</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see the solution</p>
</summary>
<p><br></p>
<p>When planning the study, the epidemiologist considered this DAG:</p>
<p><img src="../images/tbe/tbe_dag.png" class="img-fluid"></p>
<p><img src="../images/tbe/legend_dag.png" class="img-fluid"></p>
<p><br></p>
</details>
<p>According to this DAG, if you want to explore the association between hypertension and severe TBE, you should adjust for:</p>
<ul>
<li><p>TBE diagnosis</p></li>
<li><p>TBE vaccination</p></li>
<li><p>age</p></li>
<li><p>large tick (=large viral load)</p></li>
<li><p>monophasic course</p></li>
<li><p>other comorbidities</p></li>
<li><p>sex.</p></li>
</ul>
<p>TBE Diagnosis is controlled by design (only cases are included).</p>
<p>Probably your DAG will look differently. This is absolutely fine, since there is not only one possible DAG. But you should be able to justify your DAG based on the existing evidence.</p>
</section>
<section id="goal-2-perform-linear-regression-in-r" class="level2">
<h2 class="anchored" data-anchor-id="goal-2-perform-linear-regression-in-r"><strong>Goal 2: Perform linear regression in R</strong></h2>
<p>Now we will work on the data frame provided which includes data for 523 patients who have been hospitalized with TBE in the years 2018 to 2020 in Germany and for whom data were collected.</p>
<p>The following variables are provided:</p>
<p><em>Table 1: Data dictionary for the dataframe “tbe.RDS”:</em></p>
<table class="table">
<thead>
<tr class="header">
<th><strong>Variable</strong></th>
<th style="text-align: left;"><strong>Description</strong></th>
<th style="text-align: left;"><strong>Values</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>age</td>
<td style="text-align: left;">age in years</td>
<td style="text-align: left;">continuous</td>
</tr>
<tr class="even">
<td>hyper</td>
<td style="text-align: left;">hypertension</td>
<td style="text-align: left;">1= yes, 0=no</td>
</tr>
<tr class="odd">
<td>vac</td>
<td style="text-align: left;">vaccinated against TBE</td>
<td style="text-align: left;">1= yes, 0=no</td>
</tr>
<tr class="even">
<td>mono</td>
<td style="text-align: left;">monophasic disease course</td>
<td style="text-align: left;">1= yes, 0=no</td>
</tr>
<tr class="odd">
<td>other</td>
<td style="text-align: left;">other comorbidities</td>
<td style="text-align: left;">1= yes, 0=no</td>
</tr>
<tr class="even">
<td>tick</td>
<td style="text-align: left;">large tick at removal</td>
<td style="text-align: left;">1= yes, 0=no</td>
</tr>
<tr class="odd">
<td>sex</td>
<td style="text-align: left;">sex</td>
<td style="text-align: left;">1= female, 0= male</td>
</tr>
<tr class="even">
<td>hospd</td>
<td style="text-align: left;">length of hospitalisation in days</td>
<td style="text-align: left;">continuous</td>
</tr>
</tbody>
</table>
<section id="step-1-set-up" class="level3">
<h3 class="anchored" data-anchor-id="step-1-set-up"><strong>Step 1: Set up</strong></h3>
<section id="step-1.1-create-a-new-r-script" class="level4">
<h4 class="anchored" data-anchor-id="step-1.1-create-a-new-r-script">Step 1.1: Create a new R script</h4>
<p>Once you have created an Rproject inside the “tbe_en” folder (as specified in the second point of the section <strong>Preparation for the case study</strong>). Create a new script with the name <em>tbe_lr</em> and save it in the subfolder “scripts”. If you are familiar with Rmarkdown, you may decide to use this type of file instead of a standard R script.</p>
</section>
<section id="step-1.2-define-r-language" class="level4">
<h4 class="anchored" data-anchor-id="step-1.2-define-r-language">Step 1.2: Define R language</h4>
<p>Depending on where you are and how you carried out R installation, your language “locale” might be different from the language of the graphs that you want to produce. For example, a french person might have a french “locale”. If that is the case, when creating a graph by day of the week, Monday will be displayed as “lundi”. If that french person wants to create an English report, as for this case study, the language “locale” should be changed.</p>
<p><strong>Task</strong>: Ensure your “locale” is in English and change it into English if it is not. If you don’t know how to do this try finding it online (searching for online help is an important skill for R users!). Otherwise, see the solution below</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To see your language locale</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.getlocale</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To change it into English</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="st">"LC_ALL"</span>, <span class="st">"English"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</details>
</section>
<section id="step-1.3-installload-packages" class="level4">
<h4 class="anchored" data-anchor-id="step-1.3-installload-packages">Step 1.3: Install/load packages</h4>
<p>Install and load the following packages: rio, skimr, janitor, gtsummary, broom, rstatix, ggfortify and tidyverse.</p>
<p>You can find more about installing/loading packages in the <a href="https://epirhandbook.com/en/new_pages/basics.html#packages">Packages</a> section of the EpiRhandbook.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>You may end up using a long list of packages. Unfortunately different packages have functions with the same name. For example, the package {dplyr} (already installed with {tidyverse}) has a function called <code>select()</code> which we frequently use to subset columns of a data frame. But other packages such as {MASS} do also have a function called <code>select()</code>. This could create headaches if you want to subset columns using dplyr’s <code>select()</code> but R thinks you’re calling MASS’s <code>select()</code> (we call this masking - <code>dplyr::select()</code> is masked by <code>MASS::select()</code>). Given that you are more likely to use functions from {tidyverse}, ensure that this is the last package in your <code>p_load()</code> list so that functions from {tidyverse} (including {dplyr} functions) will always “prevail”.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensures the package "pacman" is installed</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>)) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">install.packages</span>(<span class="st">"pacman"</span>) }</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install (if necessary) from CRAN and load packages to be used</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  rio,        <span class="co"># importing data  </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  skimr,      <span class="co"># get overview of data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  janitor,    <span class="co"># data cleaning and tables</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  gtsummary,  <span class="co"># summary statistics, tests and regressions </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  broom,      <span class="co"># to generate tidy tibbles of regression analysis</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  rstatix,    <span class="co"># for statistics, including statistical tests</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  ggfortify,  <span class="co"># data visualisation for statistical analysis results</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  tidyverse  <span class="co"># data management and visualization</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</details>
</section>
</section>
<section id="step-2-import-and-explore-data" class="level3">
<h3 class="anchored" data-anchor-id="step-2-import-and-explore-data"><strong>Step 2: Import and explore data</strong></h3>
<section id="step-2.1-import-the-data-and-brief-exploration" class="level4">
<h4 class="anchored" data-anchor-id="step-2.1-import-the-data-and-brief-exploration">Step 2.1: Import the data and brief exploration</h4>
<p>Import the data frame called “tbe.RDS” inside the “data” subfolder. If you are working within a project, finding the path to the dataframe should be relatively straightfoward. An “.RDS” file is an R object file. You can import this dataframe using the <code>readRDS()</code> function from {base}. However, we recommend that you use the <strong><code>import()</code></strong> function from {rio} because, as you may remember, this function will recognise the file type and import it whether the file is from R, Stata, excel or many others. If you have any doubts about importing review the <a href="https://epirhandbook.com/en/new_pages/importing.html#import-data">Import and export</a> chapter of the EpiRhandbook.</p>
<p>Then, explore the data trying to answer the following questions:</p>
<div class="webex-check">
QUESTION: How many columns does the dataframe have?
<div id="radio_SMPPFYZKLS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_SMPPFYZKLS" value=""> <span>523</span></label><label><input type="radio" autocomplete="off" name="radio_SMPPFYZKLS" value=""> <span>2</span></label><label><input type="radio" autocomplete="off" name="radio_SMPPFYZKLS" value="answer"> <span>8</span></label><label><input type="radio" autocomplete="off" name="radio_SMPPFYZKLS" value=""> <span>6</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: How many rows have missing the column ‘Other comorbidities’?
<div id="radio_CPLRQBWVRY" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_CPLRQBWVRY" value=""> <span>958</span></label><label><input type="radio" autocomplete="off" name="radio_CPLRQBWVRY" value="answer"> <span>22</span></label><label><input type="radio" autocomplete="off" name="radio_CPLRQBWVRY" value=""> <span>18</span></label><label><input type="radio" autocomplete="off" name="radio_CPLRQBWVRY" value=""> <span>39</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: How many cases have hypertension?
<div id="radio_BQHWVEYZLM" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BQHWVEYZLM" value="answer"> <span>119</span></label><label><input type="radio" autocomplete="off" name="radio_BQHWVEYZLM" value=""> <span>191</span></label><label><input type="radio" autocomplete="off" name="radio_BQHWVEYZLM" value=""> <span>332</span></label><label><input type="radio" autocomplete="off" name="radio_BQHWVEYZLM" value=""> <span>285</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: How many character columns does the dataframe have?
<div id="radio_RHMURLNBQW" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_RHMURLNBQW" value="answer"> <span>0</span></label><label><input type="radio" autocomplete="off" name="radio_RHMURLNBQW" value=""> <span>6</span></label><label><input type="radio" autocomplete="off" name="radio_RHMURLNBQW" value=""> <span>2</span></label><label><input type="radio" autocomplete="off" name="radio_RHMURLNBQW" value=""> <span>8</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: What is the difference between a column of class ‘character’ and a column of class ‘factor’?
<div id="radio_KLBQEMQICB" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_KLBQEMQICB" value=""> <span>There is no difference between these classes, those are synonims</span></label><label><input type="radio" autocomplete="off" name="radio_KLBQEMQICB" value=""> <span>Character columns contain text, whereas factors contain numbers</span></label><label><input type="radio" autocomplete="off" name="radio_KLBQEMQICB" value=""> <span>Factors are used when we have more than 5 categories of data</span></label><label><input type="radio" autocomplete="off" name="radio_KLBQEMQICB" value="answer"> <span>Both classes contain text, but factors are used when there are a limited number of unique character strings and they often represent categorical data</span></label>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>An efficient way to explore data is to use the function <code>skim()</code> from the {skimr} package, as it gives you all the information needed with only one command. Of course, there are several alternatives.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>tbe <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">"data/tbe.RDS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explore the dataframe</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(tbe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">tbe</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">523</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">factor</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">ordered</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: left;">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hyper</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 404, yes: 119</td>
</tr>
<tr class="even">
<td style="text-align: left;">vac</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 503, yes: 20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mono</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 285, yes: 238</td>
</tr>
<tr class="even">
<td style="text-align: left;">other</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">yes: 317, no: 184</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tick</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">no: 345, yes: 178</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: left;">FALSE</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">mal: 332, fem: 191</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">47.30</td>
<td style="text-align: right;">18.97</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">47.0</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">90</td>
<td style="text-align: left;">▂▅▇▆▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">hospd</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">42.23</td>
<td style="text-align: right;">13.59</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">41.5</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">86</td>
<td style="text-align: left;">▁▆▇▃▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</details>
<p>Normally, at this point we would start <strong>cleaning</strong> our data. Fortunately for you, the tbe data has already been cleaned, so you can jump directly to the fun part. However, feel free to rename/recode or change any aspect of the dataframe to accomodate it to your personal preferences.</p>
</section>
<section id="step-2.2-inspect-factor-columns" class="level4">
<h4 class="anchored" data-anchor-id="step-2.2-inspect-factor-columns">Step 2.2: Inspect factor columns</h4>
<p>As we saw before, we have 6 factor columns representing categorical variables in our dataframe. Although we looked at them with the <code>skim()</code> function, explore them further with the <code>tabyl()</code> function from the {janitor} package.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>To save time, try to always use functions that allow you to apply the same function to many different objects (e.g., multiple columns) simultaneously. You can achieve this using several approaches, such as <em>loops</em>, <em>lapply</em> or <em>purrr</em>. Here we give the solution with <em>purrr</em>, so if you want to explore further purrr have a look at the dedicated <a href="https://epirhandbook.com/new_pages/iteration.html#iter_purrr">section</a> in the EpiRhandbook.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">### One by one</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tabyl</span>(tbe, hyper)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">hyper</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no</td>
<td style="text-align: right;">404</td>
<td style="text-align: right;">0.7724665</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes</td>
<td style="text-align: right;">119</td>
<td style="text-align: right;">0.2275335</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tabyl</span>(tbe, vac)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">vac</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no</td>
<td style="text-align: right;">503</td>
<td style="text-align: right;">0.9617591</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0.0382409</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### All at once</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">%&gt;%</span> <span class="co">#we first select only the columns that are of class 'factor'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="at">.f =</span> tabyl)              <span class="co">#inside map() from {purrr} we specify the function we want to apply to the entire dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$hyper
 .x[[i]]   n   percent
      no 404 0.7724665
     yes 119 0.2275335

$vac
 .x[[i]]   n    percent
      no 503 0.96175908
     yes  20 0.03824092

$mono
 .x[[i]]   n   percent
      no 285 0.5449331
     yes 238 0.4550669

$other
 .x[[i]]   n    percent valid_percent
      no 184 0.35181644     0.3672655
     yes 317 0.60611855     0.6327345
    &lt;NA&gt;  22 0.04206501            NA

$tick
 .x[[i]]   n   percent
      no 345 0.6596558
     yes 178 0.3403442

$sex
 .x[[i]]   n   percent
    male 332 0.6347992
  female 191 0.3652008</code></pre>
</div>
</div>
<p><br></p>
</details>
</section>
<section id="step-2.3-histogram-with-length-of-hospitalisation" class="level4">
<h4 class="anchored" data-anchor-id="step-2.3-histogram-with-length-of-hospitalisation">Step 2.3: Histogram with length of hospitalisation</h4>
<p>Our outcome variable will be length of hospitalisation in days (column <em>hospd</em>). It might be worth it looking at this column in more detail, as its characteristics may influence how will carry out the analysis later on. One important aspect is to check its distribution and ascertain, at least visually, if it follows a normal distribution.</p>
<p><strong>Task</strong> Create an histogram with the distribution of <em>hospd</em>. Try adding the normal curve to this histogram.</p>
<div class="webex-check">
QUESTION: Does lenght of hospitalisation look like normally distributed?
<div id="radio_JWOQRPMXHC" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_JWOQRPMXHC" value="answer"> <span>Yes</span></label><label><input type="radio" autocomplete="off" name="radio_JWOQRPMXHC" value=""> <span>No</span></label>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>There are many ways to create an histogram in R, but try using the package {ggplot2}. You can have a look at the <a href="https://epirhandbook.com/new_pages/ggplot_basics.html">ggplot basics</a> chapter of the EpiRhandbook if you struggle.</p>
<p>Adding the normal curve to the histogram may prove quite challenging. Do not worry if you don’t manage. One hint is that, in the histogram, you will need to display the <strong>density</strong> and not the frequency count. Try asking a <em>search engine</em> or any <em>AI platform</em> for help. Most of us use these tools on a daily basis to ask for help in R.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>                                  <span class="co">#we call the data first and we pass it into ggplot with the pipe operator</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospd)) <span class="sc">+</span>     <span class="co">#when drawing an histogram we only need to specify the x-axis   </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span> <span class="co">#here we are telling ggplot2 to display the density and not the freq count</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#the function below will add the normal curve. </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,  <span class="co">#In the fun = argument we are specifying that we want the normal curve         </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tbe<span class="sc">$</span>hospd, <span class="at">na.rm =</span> T), <span class="co">#to draw a normal curve we need to give the mean and standard deviation of our column</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sd   =</span> <span class="fu">sd</span>(tbe<span class="sc">$</span>hospd, <span class="at">na.rm =</span> T)),  </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="co"># Identify the colour and line width of the normal curve</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now, that was tough! But we’re here to push you out of your comfort zone. Let’s go into more detail about what we have done.</p>
<p>By now, you should feel comfortable creating a basic histogram using ggplot, so let’s focus on the new things. We have added another aesthetic to the <code>geom_histogram()</code> in which we specify that we want the density plotted and not the frequency count. <strong>Why is that?</strong> Displaying the density is more appropriate when we want to focus on the shape of the data, as we can see the underlying probability distribution more clearly.</p>
<p>But, <strong>what is actually the density?</strong> The density represents the relative frequency, what we do is scale the y-axis so that the area under the histogram equals 1, normalising the histogram to represent probabilities (density) rather than raw counts. In fact, look at how the y-axis changes when you represent the density and when you represent the counts.</p>
<p>Finally, <strong>why are we putting two dots before and after density in the aes()?</strong> The double dots before and after ..density.. are a special syntax used within ggplot2. They indicate an internal variable that ggplot2 calculates during the plotting process. So, ggplot2 normally calculates the density for histograms, but it does not display it unless you specify it (with this syntax).</p>
<p><br></p>
</details>
</section>
<section id="step-2.4-create-a-cross-table-and-calculate-a-statistical-test" class="level4">
<h4 class="anchored" data-anchor-id="step-2.4-create-a-cross-table-and-calculate-a-statistical-test">Step 2.4: Create a cross-table and calculate a statistical test</h4>
<p>Let’s say that we now want to explore whether sex is associated with hypertension. To find this out, create a cross-table displaying these two variables and calculate the appropriate statistical test to know if there is a statistical association between them.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>There are several ways in which you can do this. You could, for example, create the cross-table with <code>tabyl()</code> and then separately calculate the statistical test. The easiest way would be to use the <code>tbl_summary()</code> function from the {gtsummary} package, which allows you to do both, the cross tabulation and the statistical tests, in the same command. You should be familiar with this package by now, but if you need a little refresher have a look at the dedicated <a href="https://epirhandbook.com/new_pages/stat_tests.html#stats_gt">chapter</a> of the EpiRhandbook.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(hyper, sex) <span class="sc">%&gt;%</span>   <span class="co">#we select the columns we are interested in</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(<span class="at">by =</span> hyper) <span class="sc">%&gt;%</span> <span class="co">#we specify that we want by hypertension status</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_p</span>()                     <span class="co"># adding this command will calculate the most appropriate statistical test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="wjqshymaoh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wjqshymaoh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wjqshymaoh thead, #wjqshymaoh tbody, #wjqshymaoh tfoot, #wjqshymaoh tr, #wjqshymaoh td, #wjqshymaoh th {
  border-style: none;
}

#wjqshymaoh p {
  margin: 0;
  padding: 0;
}

#wjqshymaoh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wjqshymaoh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wjqshymaoh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wjqshymaoh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wjqshymaoh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjqshymaoh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjqshymaoh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjqshymaoh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wjqshymaoh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wjqshymaoh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wjqshymaoh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wjqshymaoh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wjqshymaoh .gt_spanner_row {
  border-bottom-style: hidden;
}

#wjqshymaoh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wjqshymaoh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wjqshymaoh .gt_from_md > :first-child {
  margin-top: 0;
}

#wjqshymaoh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wjqshymaoh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wjqshymaoh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wjqshymaoh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wjqshymaoh .gt_row_group_first td {
  border-top-width: 2px;
}

#wjqshymaoh .gt_row_group_first th {
  border-top-width: 2px;
}

#wjqshymaoh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjqshymaoh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wjqshymaoh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wjqshymaoh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjqshymaoh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjqshymaoh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wjqshymaoh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wjqshymaoh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wjqshymaoh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjqshymaoh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjqshymaoh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjqshymaoh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjqshymaoh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjqshymaoh .gt_left {
  text-align: left;
}

#wjqshymaoh .gt_center {
  text-align: center;
}

#wjqshymaoh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wjqshymaoh .gt_font_normal {
  font-weight: normal;
}

#wjqshymaoh .gt_font_bold {
  font-weight: bold;
}

#wjqshymaoh .gt_font_italic {
  font-style: italic;
}

#wjqshymaoh .gt_super {
  font-size: 65%;
}

#wjqshymaoh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wjqshymaoh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wjqshymaoh .gt_indent_1 {
  text-indent: 5px;
}

#wjqshymaoh .gt_indent_2 {
  text-indent: 10px;
}

#wjqshymaoh .gt_indent_3 {
  text-indent: 15px;
}

#wjqshymaoh .gt_indent_4 {
  text-indent: 20px;
}

#wjqshymaoh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>no</strong>, N = 404<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>no</strong>, N = 404<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>yes</strong>, N = 119<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>yes</strong>, N = 119<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>"><strong>p-value</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">sex</td>
<td headers="stat_1" class="gt_row gt_center"><br></td>
<td headers="stat_2" class="gt_row gt_center"><br></td>
<td headers="p.value" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;male</td>
<td headers="stat_1" class="gt_row gt_center">253 (63%)</td>
<td headers="stat_2" class="gt_row gt_center">79 (66%)</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;female</td>
<td headers="stat_1" class="gt_row gt_center">151 (37%)</td>
<td headers="stat_2" class="gt_row gt_center">40 (34%)</td>
<td headers="p.value" class="gt_row gt_center"><br></td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%)</td>
    </tr>
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> Pearson’s Chi-squared test</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<p>As you can see, there isn’t a significant association between sex and hypertension.</p>
</section>
</section>
<section id="step-3-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-age" class="level3">
<h3 class="anchored" data-anchor-id="step-3-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-age"><strong>Step 3: Check if there is a linear association between length of hospitalisation and age</strong></h3>
<p>Age is a potential confounder for a more severe course of TBE involving a longer stay in hospital, for which we would like to adjust. Since age is a continuous variable, we could include it in the regression model in various ways (e.g.&nbsp;as a continuous variable, in categories, by transforming it, etc.). In order to decide this, we need to analyze the association of age with the length of hospitalisation.</p>
<section id="step-3.1-inspect-a-potential-linear-association" class="level4">
<h4 class="anchored" data-anchor-id="step-3.1-inspect-a-potential-linear-association">Step 3.1: Inspect a potential linear association</h4>
<p>Please first have a look at the relationship between age and length of hospitalisation using a scatterplot.</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>    </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age,        <span class="co"># we put length of hospitalisation on the y-axis because this axis usually contains the dependent variable; and here we want to know if hospd depends on age</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> hospd)) <span class="sc">+</span>    </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                       <span class="co"># this geometry will create a scatterplot</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Age"</span> , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span>          <span class="co"># Format the x-axis to a range between 0 and 100 </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">70</span>)) <span class="sc">+</span>                          <span class="co"># Format the y axis to a range between 0 and 70</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Length of hospitalisation in days"</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                            <span class="co"># Add a pre-defined theme for formatting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>What do you think? Is there a linear association? How can you be sure? Add a linear model trend line to help you with the interpretation.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>For the trend line, you can add a <code>geom_smooth()</code> geometry. Look up the documentation for geom_smooth (you can type <code>?geom_smooth()</code> in the console and press “Enter”) and search for the methods option.For a linear trend line you can assign the methods argument to “lm” (linear model). <br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>    </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age,        <span class="co"># we put length of hospitalisation on the y-axis because this axis usually contains the dependent variable; and here we want to know if hospd depends on age</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> hospd)) <span class="sc">+</span>    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                       <span class="co"># this geometry will create a scatterplot</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span>           <span class="co"># this geometry will add a trend line. "lm" is for "linear model"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Age"</span> , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span>          <span class="co"># Format the x-axis to a range between 0 and 100 </span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">70</span>)) <span class="sc">+</span>                          <span class="co"># Format the y axis to a range between 0 and 70</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Length of hospitalisation in days"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                            <span class="co"># Add a pre-defined theme for formatting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>Now you have visual evidence of a linear association of age with the duration of hospitalisation. Therefore, <strong>it seems reasonable to include age as a continuous variable in the analysis.</strong></p>
</section>
<section id="step-3.2-check-if-the-association-between-age-and-length-of-hospitalisation-varies-by-sex" class="level4">
<h4 class="anchored" data-anchor-id="step-3.2-check-if-the-association-between-age-and-length-of-hospitalisation-varies-by-sex">Step 3.2: Check if the association between age and length of hospitalisation varies by sex</h4>
<p>Now, check visually whether the association between age and hospd differs by sex</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>You may choose to create separate graphs adding a <code>facet_grid()</code> to your <code>ggplot()</code> (try looking up the syntax yourself). You may also decide to use colour coding to differentiate between factor levels of sex. For the latter, where do you think you should specify the colour, inside or outside the <code>aes()</code>? Read this <a href="https://epirhandbook.com/new_pages/ggplot_basics.html#ggplotgroups">section</a> of the EpiRhandbook if you have doubts.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># As separate graphs</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>    </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age,        <span class="co"># we put length of hospitalisation on the y-axis because this axis usually contains the dependent variable; and here we want to know if hospd depends on age</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> hospd)) <span class="sc">+</span>    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                       <span class="co"># this geometry will create a scatterplot</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span>           <span class="co"># this geometry will add a trend line. "lm" is for "linear model"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>sex)  <span class="sc">+</span>                   <span class="co"># adding this function will generate a separate graph for each category of sex</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Age"</span> , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span>          <span class="co"># Format the x-axis to a range between 0 and 100 </span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">70</span>)) <span class="sc">+</span>                          <span class="co"># Format the y axis to a range between 0 and 70</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Length of hospitalisation in days"</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                            <span class="co"># Add a pre-defined theme for formatting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same graphs with different colours</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>    </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age,        <span class="co"># we put length of hospitalisation on the y-axis because this axis usually contains the dependent variable; and here we want to know if hospd depends on age</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> hospd,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colour =</span> sex )) <span class="sc">+</span> <span class="co">#we add the colour in the aes so that it varies according to the categories of sex   </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                       <span class="co"># this geometry will create a scatterplot</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span>           <span class="co"># this geometry will add a trend line. "lm" is for "linear model"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Age"</span> , <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span>          <span class="co"># Format the x-axis to a range between 0 and 100 </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">70</span>)) <span class="sc">+</span>                          <span class="co"># Format the y axis to a range between 0 and 70</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Length of hospitalisation in days"</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                            <span class="co"># Add a pre-defined theme for formatting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<ul>
<li><p><strong>What do you observe?</strong> The lines for female and male patients have different slopes, indicating that the association between age and hospitalisation days is modified by sex.</p></li>
<li><p><strong>Why does this matter?</strong> Since there are different effects of age on the length of the hospitalisation by sex, you may want to control for this.</p></li>
</ul>
</section>
</section>
<section id="step-4-check-if-there-is-a-difference-in-length-of-hospitalisation-by-hypertension-status" class="level3">
<h3 class="anchored" data-anchor-id="step-4-check-if-there-is-a-difference-in-length-of-hospitalisation-by-hypertension-status"><strong>Step 4: Check if there is a difference in length of hospitalisation by hypertension status</strong></h3>
<p>Let’s now focus on our exposure of interest (hypertension). We can check whether TBE cases with high blood pressure have a significant longer stay in hospital compared with those without high blood pressure either by carrying out a simple statistical test or through univariate regression. We will do both.</p>
<section id="step-4.1-simple-statistical-test" class="level4">
<h4 class="anchored" data-anchor-id="step-4.1-simple-statistical-test">Step 4.1: Simple statistical test</h4>
<p>One way would be to carry out a <strong>simple statistical test</strong> which enables us to ascertain if there is a significant difference between groups. As you know, the choice of statistical test will be determined by the number of groups that we have and the nature of the variables. If you don’t remember well how to choose the appropriate statistical test have a look at this <a href="https://www.bmj.com/about-bmj/resources-readers/publications/statistics-square-one/13-study-design-and-choosing-statisti">BMJ article</a></p>
<div class="webex-check">
QUESTION: What simple statistical tests do you think would be most appropriate in this case?
<div id="radio_TOXPAYCOOL" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TOXPAYCOOL" value=""> <span>Chi-square or Fisher's exact test</span></label><label><input type="radio" autocomplete="off" name="radio_TOXPAYCOOL" value=""> <span>ANOVA or Kruskal Wallis</span></label><label><input type="radio" autocomplete="off" name="radio_TOXPAYCOOL" value="answer"> <span>Student t test or Mann Whitney/Wilcoxon rank-sum test</span></label><label><input type="radio" autocomplete="off" name="radio_TOXPAYCOOL" value=""> <span>McNemar's test or Spears Rank</span></label>
</div>
</div>
<p>In this case we have independent data, two groups (hypertension yes/no) and a quantitative dependent outcome (length of hospitalisation), so we will choose either a <strong>t-test</strong> or <strong>Wilcoxon rank-sum test</strong> (also known as Mann-Whitney). We’d do a t-test if length of hospitalisation is normally distributed and Wilcoxon if it isn’t. We already checked in <strong>Step 2.3</strong> that the distribution of <em>hospd</em> looked normal from the histogram, let’s now have a look if the distribution looks normal for both categories of hypertension: hypertension-yes and hypertension-no.</p>
<p><strong>Task</strong> Check visually whether length of hospitalisation is normally distributed for both categories of hypertension.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>A simple way to check this is by generating a histogram for <em>hospd</em> using ggplot(). Stratification by <em>hyper</em> is easily done by adding a <code>facet_grid()</code> to your ggplot, as we have already seen with the scatterplot. Looking at the frecuency distribution of “hospd” by “hypertension” can already give us an idea of whether the data is normally distributed or not.However, if we want to to add a normal curve, we’d need to plot the density and not the frequency, as you may rembember from the histogram we built above in <strong>Sep 2.3</strong>. <br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the frecuency distribution by hypertension status</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospd)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>() <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>hyper) <span class="co"># add facet_grid() to get a graph for each hyper status</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the density and add a  normal curve</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span>                                  </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> hospd, <span class="at">fill =</span> hyper)) <span class="sc">+</span>  <span class="co">#remember that for bars, fill is is the interior colour     </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span> <span class="co">#here we are telling ggplot2 to display the density and not the freq count</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span>hyper) <span class="sc">+</span> <span class="co"># add facet_grid() to get a graph for each hyper status</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#the function below will add the normal curve. </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,  <span class="co">#The fun = argument we are specifying that we want the normal curve         </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tbe<span class="sc">$</span>hospd, <span class="at">na.rm =</span> T), <span class="co">#to draw a normal curve we need to give the mean and standard deviation of our column</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sd   =</span> <span class="fu">sd</span>(tbe<span class="sc">$</span>hospd, <span class="at">na.rm =</span> T)),  </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># Identify the colour and line width of the normal curve</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Length of hospitalisation in days"</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>From the graphs looks like the data is normally distributed, but there is a test we can do to determine this: <strong>Shapiro-Wilk test</strong>.</p>
<p><strong>Task</strong>: Use the Shapiro test to determine whether length of hospitalisation comes from a normally-distributed population.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>You can choose {base} functions to carry out the Shapiro test (and any other statistical test) or functions from the {rstatix} package. Here we will use the latter, because {rstatix} has a syntax that is compatible with {dplyr}, which can be an advantage. In any case the name of the functions are very similar. For example, using {base} the Shapiro test function is <code>shapiro.test()</code>; and with {rstatix} the same function is written as: <code>shapiro_test()</code>. If you want to know more about how to carry out simple statistical tests in R, read the EpiRhandbook Chapter on <a href="https://epirhandbook.com/new_pages/stat_tests.html">Simple statistical tests</a></p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hyper) <span class="sc">%&gt;%</span> <span class="co">#we first group by out independent or exposure variable</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shapiro_test</span>(hospd)  <span class="co"># this function performs the Shapiro-Wilk test for all groups separately</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">hyper</th>
<th style="text-align: left;">variable</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">no</td>
<td style="text-align: left;">hospd</td>
<td style="text-align: right;">0.9946512</td>
<td style="text-align: right;">0.2207864</td>
</tr>
<tr class="even">
<td style="text-align: left;">yes</td>
<td style="text-align: left;">hospd</td>
<td style="text-align: right;">0.9870178</td>
<td style="text-align: right;">0.3632204</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<p>The null hypothesis of Shapiro’test is that data is normally distributed. As our results were non-significant (p&gt;0.05) we cannot reject such null hypothesis. In other words, we can conclude that data is normally distributed.</p>
<p><em>Note</em>: A statistician, or an epidemiologist pretending to be a statistician, would feel very uncomfortable by the conclusion written above. When we are unable to reject a null hypothesis we cannot conclude that this hypothesis (in this case that data is normally distributed) is true, but we should simply state that we were unable to reject it. However, in practical terms, by carrying out a Shapiro test we are assuming that the data is normally distributed….so word it as you like, but the consequences are the same.</p>
<div class="webex-check">
QUESTION: Now that we know that the data is normally distributed, what test should we carry out?
<div id="radio_MVOVMXVJDY" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_MVOVMXVJDY" value="answer"> <span>Student t-test</span></label><label><input type="radio" autocomplete="off" name="radio_MVOVMXVJDY" value=""> <span>Wilcoxon rank-sum test</span></label>
</div>
</div>
<p><strong>Task</strong> Carry out the statistical test to ascertain if there are significant differences in length of hospitalisation according to hypertension status</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t_test</span>(hospd <span class="sc">~</span> hyper)  <span class="co"># we write first our dependent variable and then the exposure one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.y.</th>
<th style="text-align: left;">group1</th>
<th style="text-align: left;">group2</th>
<th style="text-align: right;">n1</th>
<th style="text-align: right;">n2</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hospd</td>
<td style="text-align: left;">no</td>
<td style="text-align: left;">yes</td>
<td style="text-align: right;">373</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">-2.706422</td>
<td style="text-align: right;">181.4443</td>
<td style="text-align: right;">0.00745</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<div class="webex-check">
QUESTION: Is there a significant difference in the length of hospitalisation among patients with and without hypertension?
<div id="radio_XQZAULHXYU" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_XQZAULHXYU" value="answer"> <span>Yes</span></label><label><input type="radio" autocomplete="off" name="radio_XQZAULHXYU" value=""> <span>No</span></label>
</div>
</div>
<p><em>Note</em>: In large datasets (as this one) the Shapiro-Wilk test may reject the normality hypothesis even though the deviation from the normal distribution is rather small. In this case you may still choose to calculate the t-test despite the violation of the normality assumption. This is acceptable because for large samples, the error imposed by t-test approximation is negligible.</p>
</section>
<section id="step-4.2-univariate-linear-regression-between-hospd-and-hyper" class="level4">
<h4 class="anchored" data-anchor-id="step-4.2-univariate-linear-regression-between-hospd-and-hyper">Step 4.2: Univariate linear regression between hospd and hyper</h4>
<p>The other way was through univariate regression. Carry out a univariate linear regression with length of hospitalisation (hospd) as the dependent variable and hypertension as the independent variable. Assign this model to an object named: <em>hyper_hospd_lm</em>. If this is the first time doing regression in R, have a look at the <a href="https://epirhandbook.com/new_pages/regression.html#univariate">Univariate</a> regression chapter of the EpiRhandbook.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>As we are doing linear regression, we could use the <code>lm()</code> function from {base} to analyse the association between hypertension and length of hospitalisation. The syntax is: lm(outcome/dependent variable ~ exposure/independent variable, data = dataframe) You can print the model output in a subsequent command using the <code>summary()</code> function. However, the <code>tidy()</code> function from {broom} provides an overview which can be more easily compiled and used in down-stream analyses if needed.</p>
<p>The approach described above is the {base} R approach. You can also perform univariate regression analysis using the function <code>tbl_uvregression()</code> from the {gtsummary} package. If you want to explore this alternative approach further read the dedicated EpiRhandbook <a href="https://epirhandbook.com/new_pages/regression.html#reg_gt_uni">chapter</a> <br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First we write the formula (lm stands for linear model) and assign the model to an object</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper, <span class="at">data=</span> tbe)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prin the detailed output of the model</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(hyper_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hospd ~ hyper, data = tbe)

Residuals:
    Min      1Q  Median      3Q     Max 
-38.324  -9.324  -1.261   9.676  44.676 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  41.3244     0.6991  59.113  &lt; 2e-16 ***
hyperyes      3.9369     1.4598   2.697  0.00724 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.5 on 482 degrees of freedom
  (39 observations deleted due to missingness)
Multiple R-squared:  0.01487,   Adjusted R-squared:  0.01282 
F-statistic: 7.273 on 1 and 482 DF,  p-value: 0.007243</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the main model parameters</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>results_hyper_hospd_lm <span class="ot">&lt;-</span> <span class="fu">tidy</span>(hyper_hospd_lm) </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>results_hyper_hospd_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">41.324397</td>
<td style="text-align: right;">0.6990698</td>
<td style="text-align: right;">59.113403</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.936864</td>
<td style="text-align: right;">1.4597610</td>
<td style="text-align: right;">2.696924</td>
<td style="text-align: right;">0.0072434</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<div class="webex-check">
QUESTION: Based on the results of this model, is there a significant association between hypertension and hospd?
<div id="radio_ZJTLURWFQR" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_ZJTLURWFQR" value="answer"> <span>Yes</span></label><label><input type="radio" autocomplete="off" name="radio_ZJTLURWFQR" value=""> <span>No</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: How much does having hypertension increase length of hospitalisation (in days)?
<div id="radio_LDBSXMKGYZ" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_LDBSXMKGYZ" value="answer"> <span>3.9</span></label><label><input type="radio" autocomplete="off" name="radio_LDBSXMKGYZ" value=""> <span>41.3</span></label><label><input type="radio" autocomplete="off" name="radio_LDBSXMKGYZ" value=""> <span>1.46</span></label><label><input type="radio" autocomplete="off" name="radio_LDBSXMKGYZ" value=""> <span>1.2</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: What % of the variability in length of hospitalisation can be explained by hypertension?
<div id="radio_YERQMOWCWV" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_YERQMOWCWV" value=""> <span>2.7%</span></label><label><input type="radio" autocomplete="off" name="radio_YERQMOWCWV" value=""> <span>41%</span></label><label><input type="radio" autocomplete="off" name="radio_YERQMOWCWV" value="answer"> <span>1.3%</span></label><label><input type="radio" autocomplete="off" name="radio_YERQMOWCWV" value=""> <span>3%</span></label>
</div>
</div>
<p>In this case the regression equation is: <span class="math inline">\(hopsd(predicted)=41.3+3.9⋅hyper\)</span>.</p>
<p>Now let’s go through the outputs of the model. We will first review the outputs of the <code>tidy()</code> function. As explained before, the advantage of using <code>tidy()</code> is that we can save the output as an object for further manipulation. Also, <code>tidy()</code> keeps what we would normally need in epidemiology for the interpretation of the model:</p>
<p>We have four columns and two rows. The rows refer to the <strong>intercept</strong> (baseline value for hospd when there is NO hypertension: 41.3) and our only exposure/predictor (hypertension). In most cases, you will be interested in the row for <strong>hypertension</strong> (your predictor) and in the columns <strong>estimate</strong> and <strong>p.value</strong>. The <strong>estimate</strong> of hypertension tells us the estimated change in hospd when you go from NO hypertension to YES hypertension (that’s why it is written as <em>hyperyes</em>). In this case, it’s approximately 3.94, meaning that having hypertension is associated with an increase in 3.94 days of hospitalisation. The column <strong>p.value</strong> tells us whether this estimate is statistically significant.</p>
<p><strong>This is most of what you need to know to be a functional epidemiologist</strong>. But if you want to know more, we will explain the rest of the elements of the output of both functions:</p>
<p>The column <strong>std.error</strong> provides an estimate of the variability or uncertainty associated with the estimate. In this case it means that the estimated effect of hypertension on hospitalisation duration (hospd) is expected to vary by about 1.46 days (on average) due to sampling variability. Finally, the <strong>statistic</strong> column gives us a value of the statistical test (t-test in this case) used to ascertain if the estimate is significantly different from 0 (normally you can ignore this column).</p>
<p>You may have noticed that the <code>summary()</code> output has more information than the <code>tidy()</code> output. Here we leave a brief explanation on what each part of the <code>summary()</code> output means:</p>
<p><strong>Call:</strong> This line shows the formula used for the regression model.</p>
<p><strong>Residuals:</strong> These are the differences between the actual hospd values and the predicted values from the regression model. The summary provides statistics like minimum, median, and maximum residuals.</p>
<p><strong>Coefficients:</strong> This is the bit that interests us the most:</p>
<ul>
<li><strong>Intercept</strong>: The estimated intercept (baseline value) for hospd when age is zero. In this case, it’s approximately 41.3.</li>
<li><strong>hyperyes:</strong> The estimated change in hospd when you go from NO hypertension to YES hypertension. Here, it’s approximately 3.9. The t-value and <strong>p-value</strong> indicate whether this coefficient is statistically significant.</li>
</ul>
<p><strong>Significance Codes:</strong> Indicate whether the p-value is highly significant (*** p &lt; 0.001) or only marginally significant (* p&lt;0.05)</p>
<p><strong>Residual Standard Error:</strong> This measures the average deviation of the observed hospd values from the regression line. In this case, it’s approximately 13.5.</p>
<p><strong>Multiple and Adjusted R-squared:</strong> These values (0.01487 and 0.01282) represent the proportion of variance in hospd explained by the linear relationship with hypertension. Higher values indicate better fit. The adjusted one is adjusted for the number of predictors. In this case we could say that around 1.3% of the variability in hospd is explained by hypertension.</p>
<p><strong>F-statistic and p-value:</strong> The F-statistic tests whether the overall model (including all predictors) is significant. A low p-value (like this one, &lt; 0.007243) indicates that the model is significant.</p>
</section>
</section>
<section id="step-5-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-the-rest-of-variables" class="level3">
<h3 class="anchored" data-anchor-id="step-5-check-if-there-is-a-linear-association-between-length-of-hospitalisation-and-the-rest-of-variables"><strong>Step 5: Check if there is a linear association between length of hospitalisation and the rest of variables</strong></h3>
<p>We also need to know if there is a univariate association between our outcome (length of hospitalisation) and the confounders we may want to introduce in our model. We will do this in two steps, first with the continous variable and then with the factor variables.</p>
<section id="step-5.1-univariate-linear-regression-between-length-of-hospitalisation-and-age" class="level4">
<h4 class="anchored" data-anchor-id="step-5.1-univariate-linear-regression-between-length-of-hospitalisation-and-age">Step 5.1: Univariate linear regression between length of hospitalisation and age</h4>
<p>Try running a linear regression model with length of hospitalisation (hospd) as the dependent variable and age as the independent variable.</p>
<div class="webex-check">
QUESTION: Based on the results of the model, is there a significant association between age and hospd?
<div id="radio_UYDSGIJHSR" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_UYDSGIJHSR" value="answer"> <span>Yes</span></label><label><input type="radio" autocomplete="off" name="radio_UYDSGIJHSR" value=""> <span>No</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: How much does an additional year of age increase length of hospitalisation (in days)?
<div id="radio_CDRQRNDSQO" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_CDRQRNDSQO" value="answer"> <span>0.372</span></label><label><input type="radio" autocomplete="off" name="radio_CDRQRNDSQO" value=""> <span>24.5</span></label><label><input type="radio" autocomplete="off" name="radio_CDRQRNDSQO" value=""> <span>0.271</span></label><label><input type="radio" autocomplete="off" name="radio_CDRQRNDSQO" value=""> <span>1.42</span></label>
</div>
</div>
<div class="webex-check">
QUESTION: What % of the variability in length of hospitalisation can be explained by age?
<div id="radio_YWAXRZSJSK" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_YWAXRZSJSK" value=""> <span>65%</span></label><label><input type="radio" autocomplete="off" name="radio_YWAXRZSJSK" value=""> <span>15%</span></label><label><input type="radio" autocomplete="off" name="radio_YWAXRZSJSK" value="answer"> <span>27%</span></label><label><input type="radio" autocomplete="off" name="radio_YWAXRZSJSK" value=""> <span>99%</span></label>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the linear regression and assign the output to age_hospd_lm</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>age_hospd_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> age, <span class="at">data =</span> tbe)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results using the summary() function</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(age_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hospd ~ age, data = tbe)

Residuals:
    Min      1Q  Median      3Q     Max 
-35.676  -7.893   0.521   6.844  32.279 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  24.5314     1.4233   17.24   &lt;2e-16 ***
age           0.3722     0.0278   13.39   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11.61 on 482 degrees of freedom
  (39 observations deleted due to missingness)
Multiple R-squared:  0.2711,    Adjusted R-squared:  0.2696 
F-statistic: 179.2 on 1 and 482 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of the regression analysis with the tidy() function</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(age_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">24.5314214</td>
<td style="text-align: right;">1.4232588</td>
<td style="text-align: right;">17.23609</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3722366</td>
<td style="text-align: right;">0.0278031</td>
<td style="text-align: right;">13.38831</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
</section>
<section id="step-5.2-univariate-linear-regression-between-length-of-hospitalisation-and-factor-variables" class="level4">
<h4 class="anchored" data-anchor-id="step-5.2-univariate-linear-regression-between-length-of-hospitalisation-and-factor-variables">Step 5.2: Univariate linear regression between length of hospitalisation and factor variables</h4>
<p>Now carry out a similar univariate model for each of the factor variables that we have not explored to ascertain which ones are significantly associated with length of hospitalisation.</p>
<div class="webex-check">
QUESTION: What of the following variables have a significant linear association with length of hospitalisation?
<div id="radio_PSXUWIVXBE" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_PSXUWIVXBE" value="answer"> <span>Sex</span></label><label><input type="radio" autocomplete="off" name="radio_PSXUWIVXBE" value="answer"> <span>Other comorbidities</span></label><label><input type="radio" autocomplete="off" name="radio_PSXUWIVXBE" value="answer"> <span>Monophasic disease</span></label><label><input type="radio" autocomplete="off" name="radio_PSXUWIVXBE" value=""> <span>Large tick at removal</span></label><label><input type="radio" autocomplete="off" name="radio_PSXUWIVXBE" value="answer"> <span>Vaccinated against TBE</span></label>
</div>
</div>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>We have seen already how to write a linear formula with <code>lm()</code>. You can then use either <code>summary()</code> from {base} or <code>tidy()</code> from {broom} to look at the coefficient and significance value. You could write these functions for each variable, but you could also try to use map() from {purrr} to do them all at once, as we did in the <strong>Step 2.2</strong>. Have a look at the Chapter on <a href="https://epirhandbook.com/new_pages/iteration.html#iter_purrr">Purrr</a> in the EpiRhandbook if you have any doubts.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we write one by one for each variable the formula and tidy</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#sex</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>sex_hospd_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> sex, <span class="at">data =</span> tbe)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(sex_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">46.66559</td>
<td style="text-align: right;">0.6932755</td>
<td style="text-align: right;">67.31176</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-12.41704</td>
<td style="text-align: right;">1.1595927</td>
<td style="text-align: right;">-10.70810</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#other comorbidities</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>other_hospd_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> other, <span class="at">data =</span> tbe)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(other_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">39.590909</td>
<td style="text-align: right;">1.014237</td>
<td style="text-align: right;">39.035162</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">otheryes</td>
<td style="text-align: right;">4.142857</td>
<td style="text-align: right;">1.271413</td>
<td style="text-align: right;">3.258466</td>
<td style="text-align: right;">0.0011993</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#vaccination</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>vac_hospd_lm    <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> vac, <span class="at">data =</span> tbe)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(vac_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">42.556989</td>
<td style="text-align: right;">0.6262426</td>
<td style="text-align: right;">67.956072</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-8.399095</td>
<td style="text-align: right;">3.1607381</td>
<td style="text-align: right;">-2.657321</td>
<td style="text-align: right;">0.0081379</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#monophasic course</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mono_hospd_lm   <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> mono, <span class="at">data =</span> tbe)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mono_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">40.690566</td>
<td style="text-align: right;">0.8291071</td>
<td style="text-align: right;">49.077574</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">monoyes</td>
<td style="text-align: right;">3.396192</td>
<td style="text-align: right;">1.2325691</td>
<td style="text-align: right;">2.755377</td>
<td style="text-align: right;">0.0060844</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#large tick at removal</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>tick_hospd_lm   <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> tick, <span class="at">data =</span> tbe) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(tick_hospd_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">42.731250</td>
<td style="text-align: right;">0.7593945</td>
<td style="text-align: right;">56.270158</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">tickyes</td>
<td style="text-align: right;">-1.487348</td>
<td style="text-align: right;">1.3045725</td>
<td style="text-align: right;">-1.140103</td>
<td style="text-align: right;">0.2548094</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Here we do it with {purrr} all in one command</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tbe <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hyper, <span class="sc">-</span>age, <span class="sc">-</span>hospd) <span class="sc">%&gt;%</span> <span class="co"># we first remove the columns we have explored before + the outcome column</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">lm</span>(hospd <span class="sc">~</span> .x, <span class="at">data =</span> tbe)) <span class="sc">%&gt;%</span>   <span class="co"># here we carry out the model for each column. ".x" represents all the column</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(tidy)                                   <span class="co"># finally we do tidy on each model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$vac
# A tibble: 2 x 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    42.6      0.626     68.0  4.69e-249
2 .xyes          -8.40     3.16      -2.66 8.14e-  3

$mono
# A tibble: 2 x 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    40.7      0.829     49.1  1.30e-189
2 .xyes           3.40     1.23       2.76 6.08e-  3

$other
# A tibble: 2 x 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    39.6       1.01     39.0  2.43e-151
2 .xyes           4.14      1.27      3.26 1.20e-  3

$tick
# A tibble: 2 x 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)    42.7      0.759     56.3  5.50e-214
2 .xyes          -1.49     1.30      -1.14 2.55e-  1

$sex
# A tibble: 2 x 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     46.7     0.693      67.3 2.99e-247
2 .xfemale       -12.4     1.16      -10.7 3.79e- 24</code></pre>
</div>
</div>
<p><br></p>
</details>
<p>Statistically significant (<span class="math inline">\(p&lt;0.05\)</span>) univariable effects were observed for sex, other comorbidities, vaccination and monophasic disease course but not for large tick at removal. Women had on average 12.4 days shorter hospitalisation stay than men, other comorbidities increase the hospitalisation by 4.1 days, vaccination reduced it by 8.4 days, and monophasic disease course increased it by 3.4 days.</p>
</section>
</section>
<section id="step-6-multivariable-analysis" class="level3">
<h3 class="anchored" data-anchor-id="step-6-multivariable-analysis"><strong>Step 6: Multivariable analysis</strong></h3>
<p>To control for possible confounding, we will adjust for the minimum adjustment set that we have identified through the DAG analysis (<strong>Goal 1</strong>), adding each variable in different steps.</p>
<section id="step-6.1-add-age-as-a-covariate-to-the-model" class="level4">
<h4 class="anchored" data-anchor-id="step-6.1-add-age-as-a-covariate-to-the-model">Step 6.1: Add age as a covariate to the model</h4>
<p>As a first step, add age to the model of the main effect.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>We have already calculated and saved the model of our main effect (<em>hyper_hospd_lm</em>). You can add age to this model by creating a new model and adding the additional variable, so that the formula syntax is model &lt;- lm(hospd ~ hyper + newVariable, data = data)</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a new model and adding age </span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age, <span class="at">data =</span> tbe)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">23.6918245</td>
<td style="text-align: right;">1.437666</td>
<td style="text-align: right;">16.479366</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.8015966</td>
<td style="text-align: right;">1.245007</td>
<td style="text-align: right;">3.053473</td>
<td style="text-align: right;">0.0023875</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3715581</td>
<td style="text-align: right;">0.027567</td>
<td style="text-align: right;">13.478364</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<p>Adjusting for age, we find that hypertension is associated with a 3.8 increase in the days of hospitalisations. This is only a slight change compared to the effect in the unadjusted model (where the coefficient was 3.9).</p>
</section>
<section id="step-6.2-compare-the-performance-of-both-models" class="level4">
<h4 class="anchored" data-anchor-id="step-6.2-compare-the-performance-of-both-models">Step 6.2: Compare the performance of both models</h4>
<p>We have the univariate model (<em>hyper_hospd_lm</em>), and now we have one adjusted by age (<em>hyper_hospd_adj_lm</em>). Compare both models calculating model performance metrics such as AIC and logLik.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>One easy function to calculate performance metrics is <code>glance()</code> from the {broom} package. But, of course, there are many others. Choose the one you feel most comfortable with!</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_lm)   <span class="co"># performance metrics of the univariate model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0148657</td>
<td style="text-align: right;">0.0128219</td>
<td style="text-align: right;">13.50128</td>
<td style="text-align: right;">7.273399</td>
<td style="text-align: right;">0.0072434</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-1945.512</td>
<td style="text-align: right;">3897.024</td>
<td style="text-align: right;">3909.57</td>
<td style="text-align: right;">87861.17</td>
<td style="text-align: right;">482</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm) <span class="co"># performance metrics of the adjusted model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.2849348</td>
<td style="text-align: right;">0.2819616</td>
<td style="text-align: right;">11.51466</td>
<td style="text-align: right;">95.83297</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-1867.974</td>
<td style="text-align: right;">3743.948</td>
<td style="text-align: right;">3760.676</td>
<td style="text-align: right;">63774.52</td>
<td style="text-align: right;">481</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<p>The output of <code>glance()</code> gives us several performance metrics. If you want to focus on the important bits, you can look at the <strong>logLik</strong> and the <strong>AIC</strong>. A larger logLik means a better model; and a lower AIC means also a better model. So, if your logLik goes up and your AIC goes down, you are going in the right direction. The advantage of the logLik is that there is a formal test (Likelihood Ratio Test) to test if two logLiks are significantly different. However, AIC takes more things into consideration than the logLik, such as the complexity of the model (favours simpler models), so it is very useful to compare models with different numbers of parameters (like this case).</p>
<p>If you want to know more, let’s review each element of the output given by <code>glance()</code>:</p>
<ul>
<li><p><strong>r.squared</strong>: This is a measure of how well the independent variables in your model explain the variability of the dependent variable. Think of it as a percentage that tells you how much of the changes in the outcome can be predicted by the model. So, in our example, hypertension alone explains 1.5% of the variability in length of hospitalisation, but when we add age, that model explains 28.5% of the variability in our dependent variable.</p></li>
<li><p><strong>adj.r.squared</strong>: The adjusted R-squared value adjusts the R-squared value based on the number of predictors in the model. It is a more accurate measure when comparing models with different numbers of predictors (as in this case). Here, it is slightly lower at 28.2%, indicating a small adjustment for the number of predictors.</p></li>
<li><p><strong>sigma</strong>: This represents the residual standard error, which is the standard deviation of the residuals.</p></li>
<li><p><strong>statistic</strong>: This is the F-statistic value for the overall significance of the model. It tests whether at least one predictor variable has a non-zero coefficient.</p></li>
<li><p><strong>p.value</strong>: The p-value associated with the F-statistic.</p></li>
<li><p><strong>df</strong>: Degrees of freedom associated with the model which typically correspond to the number of predictors (1 in the first case and 2 in the second).</p></li>
<li><p><strong>logLik</strong>: The log-likelihood of the model, which is a measure of the model fit. Higher values indicate a better fit. As stated above, one of the main performance measures that you will use as an epidemiologist.</p></li>
<li><p><strong>AIC</strong>: Akaike Information Criterion, which is used for model comparison. Lower values indicate a better model.</p></li>
<li><p><strong>BIC</strong>: Bayesian Information Criterion, similar to AIC but with a higher penalty for models with more parameters.</p></li>
<li><p><strong>deviance</strong>: This is a measure of the goodness of fit of the model. Lower values indicate a better fit.</p></li>
<li><p><strong>df.residual</strong>: The residual degrees of freedom, which is the number of observations minus the number of parameters estimated.</p></li>
<li><p><strong>nobs</strong>: The number of observations used in the model, which is 484 in our case</p></li>
</ul>
</section>
<section id="optional-step-6.3-plotting-effects-of-age-by-hypertension" class="level4">
<h4 class="anchored" data-anchor-id="optional-step-6.3-plotting-effects-of-age-by-hypertension">(Optional) Step 6.3: Plotting effects of age by hypertension</h4>
<p>If you remember, in <strong>Step 3.2</strong> we checked visually for the association between age and length of hospitalisation by sex. Now, we will do something similar by plotting the estimated effect of age on length of hospitalisation <strong>by hypertension status</strong>. The final output that we want is a scatterplot displaying the raw data (length of hospitalisation by age), and then the fitted regression line by hypertension status.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>In order to plot the estimated effects of age by hypertension we have to extract the fitted values of “hospd” from the model and add them to the dataframe. This only works if we have removed all rows that contain NAs in the hospd column before. we can then pass this new dataframe to a <code>ggplot()</code> with a <code>geom_point()</code> for the scatterplot and <code>geom_line()</code> for the fitted trend lines. Note: Previously, we used <code>geom_smooth()</code> to add trend lines to the scatterplot. Because we want to plot the predicted values of an existing model and not fit a linear model within <code>ggplot()</code>, we have to use <code>geom_line()</code> and use the predicted values of our model as input for y.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First add a variable with the fitted values to the dataframe</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data_fitted <span class="ot">&lt;-</span> tbe <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(hospd)) <span class="sc">%&gt;%</span>   <span class="co"># Remove NAs </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">predict</span>(hyper_hospd_adj_lm)) <span class="co"># Create a new variable with the predicted values</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="do">### You can now open data_fitted to have a look at the new column</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we do the plot with the fitted lines</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>plot_fitted <span class="ot">&lt;-</span> data_fitted <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> hospd,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">colour =</span> hyper)) <span class="sc">+</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span>                            <span class="co"># Adding a scatter plot</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> fit)) <span class="sc">+</span>                 <span class="co"># we add a line specifying that we want the fitted and not the observed values in the y-axis</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Effect of age on TBE hospital stay length for people</span><span class="sc">\n</span><span class="st">with and without hypertension "</span>, <span class="co"># Title of the plot, note that "\n" breaks the title into the next line</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Length of hospitalisation in days"</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Hypertension"</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                                  <span class="co"># we add a predefined theme</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>plot_fitted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>We did not allow the association between age and hospitalisation to vary by levels of hypertension. So we force them to be parallel by the way we specify the model. If we want the slopes to differ, we would need to allow for an interaction term. We’ll get to that later.</p>
</section>
<section id="step-6.4-continue-building-the-adjusted-model-and-check-quality-of-the-model" class="level4">
<h4 class="anchored" data-anchor-id="step-6.4-continue-building-the-adjusted-model-and-check-quality-of-the-model">Step 6.4: Continue building the adjusted model and check quality of the model</h4>
<p>Continue adding the rest of variables that we have to adjust for according to the DAG (TBE vaccination, age, large tick, monophasic course, other comorbidities and sex) to the model <em>hyper_hospd_adj_lm</em> <strong>one by one</strong>. Check, after you add each variable, <strong>model performance metrics</strong> to ensure that the model is improving.</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">### We first add sex to the previous model</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age <span class="sc">+</span> sex, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">28.9661798</td>
<td style="text-align: right;">1.3613386</td>
<td style="text-align: right;">21.277718</td>
<td style="text-align: right;">0.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.4659484</td>
<td style="text-align: right;">1.1079250</td>
<td style="text-align: right;">3.128324</td>
<td style="text-align: right;">0.001865</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3452202</td>
<td style="text-align: right;">0.0246333</td>
<td style="text-align: right;">14.014368</td>
<td style="text-align: right;">0.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-11.0377082</td>
<td style="text-align: right;">0.9762639</td>
<td style="text-align: right;">-11.306071</td>
<td style="text-align: right;">0.000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.4353144</td>
<td style="text-align: right;">0.4317851</td>
<td style="text-align: right;">10.24315</td>
<td style="text-align: right;">123.3435</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">-1810.837</td>
<td style="text-align: right;">3631.674</td>
<td style="text-align: right;">3652.584</td>
<td style="text-align: right;">50362.62</td>
<td style="text-align: right;">480</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">### TBE vaccination</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> vac, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">29.0192105</td>
<td style="text-align: right;">1.3398585</td>
<td style="text-align: right;">21.658415</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.5401913</td>
<td style="text-align: right;">1.0905445</td>
<td style="text-align: right;">3.246260</td>
<td style="text-align: right;">0.0012512</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3507362</td>
<td style="text-align: right;">0.0242813</td>
<td style="text-align: right;">14.444681</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-10.9105961</td>
<td style="text-align: right;">0.9613218</td>
<td style="text-align: right;">-11.349577</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-9.6218919</td>
<td style="text-align: right;">2.3644063</td>
<td style="text-align: right;">-4.069475</td>
<td style="text-align: right;">0.0000551</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.454185</td>
<td style="text-align: right;">0.4496271</td>
<td style="text-align: right;">10.08105</td>
<td style="text-align: right;">99.6467</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-1802.611</td>
<td style="text-align: right;">3617.223</td>
<td style="text-align: right;">3642.315</td>
<td style="text-align: right;">48679.6</td>
<td style="text-align: right;">479</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Monophasic disease course</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> vac <span class="sc">+</span> mono, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">27.9231475</td>
<td style="text-align: right;">1.3632885</td>
<td style="text-align: right;">20.482199</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.7307298</td>
<td style="text-align: right;">1.0799901</td>
<td style="text-align: right;">3.454411</td>
<td style="text-align: right;">0.0006006</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3443505</td>
<td style="text-align: right;">0.0240868</td>
<td style="text-align: right;">14.296254</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-11.0608203</td>
<td style="text-align: right;">0.9517650</td>
<td style="text-align: right;">-11.621378</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-9.8262935</td>
<td style="text-align: right;">2.3391721</td>
<td style="text-align: right;">-4.200757</td>
<td style="text-align: right;">0.0000317</td>
</tr>
<tr class="even">
<td style="text-align: left;">monoyes</td>
<td style="text-align: right;">3.1330906</td>
<td style="text-align: right;">0.9155900</td>
<td style="text-align: right;">3.421936</td>
<td style="text-align: right;">0.0006751</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.4672362</td>
<td style="text-align: right;">0.4616634</td>
<td style="text-align: right;">9.970207</td>
<td style="text-align: right;">83.84164</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">-1796.755</td>
<td style="text-align: right;">3607.509</td>
<td style="text-align: right;">3636.784</td>
<td style="text-align: right;">47515.6</td>
<td style="text-align: right;">478</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Large tick at removal</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> vac <span class="sc">+</span> mono <span class="sc">+</span> tick, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">28.1079813</td>
<td style="text-align: right;">1.3968015</td>
<td style="text-align: right;">20.1231029</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">3.7655402</td>
<td style="text-align: right;">1.0821694</td>
<td style="text-align: right;">3.4796219</td>
<td style="text-align: right;">0.0005482</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3446256</td>
<td style="text-align: right;">0.0241066</td>
<td style="text-align: right;">14.2959288</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-11.0239613</td>
<td style="text-align: right;">0.9542624</td>
<td style="text-align: right;">-11.5523372</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-9.7114161</td>
<td style="text-align: right;">2.3481138</td>
<td style="text-align: right;">-4.1358371</td>
<td style="text-align: right;">0.0000418</td>
</tr>
<tr class="even">
<td style="text-align: left;">monoyes</td>
<td style="text-align: right;">3.0852716</td>
<td style="text-align: right;">0.9194697</td>
<td style="text-align: right;">3.3554903</td>
<td style="text-align: right;">0.0008555</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tickyes</td>
<td style="text-align: right;">-0.5959864</td>
<td style="text-align: right;">0.9677751</td>
<td style="text-align: right;">-0.6158315</td>
<td style="text-align: right;">0.5382995</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.4676595</td>
<td style="text-align: right;">0.4609634</td>
<td style="text-align: right;">9.976687</td>
<td style="text-align: right;">69.8405</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">-1796.562</td>
<td style="text-align: right;">3609.124</td>
<td style="text-align: right;">3642.581</td>
<td style="text-align: right;">47477.85</td>
<td style="text-align: right;">477</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Other comorbidities</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> age <span class="sc">+</span> sex <span class="sc">+</span> vac <span class="sc">+</span> mono <span class="sc">+</span> tick <span class="sc">+</span> other, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">27.1251926</td>
<td style="text-align: right;">1.4596417</td>
<td style="text-align: right;">18.5834593</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">2.7139444</td>
<td style="text-align: right;">1.1769928</td>
<td style="text-align: right;">2.3058292</td>
<td style="text-align: right;">0.0215491</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3406119</td>
<td style="text-align: right;">0.0240754</td>
<td style="text-align: right;">14.1477140</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-11.0797108</td>
<td style="text-align: right;">0.9506756</td>
<td style="text-align: right;">-11.6545649</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-9.2298015</td>
<td style="text-align: right;">2.3484899</td>
<td style="text-align: right;">-3.9301005</td>
<td style="text-align: right;">0.0000975</td>
</tr>
<tr class="even">
<td style="text-align: left;">monoyes</td>
<td style="text-align: right;">3.0995048</td>
<td style="text-align: right;">0.9157172</td>
<td style="text-align: right;">3.3847838</td>
<td style="text-align: right;">0.0007712</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tickyes</td>
<td style="text-align: right;">-0.7577796</td>
<td style="text-align: right;">0.9665465</td>
<td style="text-align: right;">-0.7840074</td>
<td style="text-align: right;">0.4334257</td>
</tr>
<tr class="even">
<td style="text-align: left;">otheryes</td>
<td style="text-align: right;">2.3008449</td>
<td style="text-align: right;">1.0351078</td>
<td style="text-align: right;">2.2228070</td>
<td style="text-align: right;">0.0266978</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.4731284</td>
<td style="text-align: right;">0.4653803</td>
<td style="text-align: right;">9.935728</td>
<td style="text-align: right;">61.06371</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">-1794.063</td>
<td style="text-align: right;">3606.126</td>
<td style="text-align: right;">3643.765</td>
<td style="text-align: right;">46990.1</td>
<td style="text-align: right;">476</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<p>As you can see, adding the rest of variables identified through the DAG improved the model, according to the metrics. The only exception was the addition of the variable “Large tick at removal”. However, the choice of covariates should be made conceptually through the DAG, and not based on whether there are small differences in AIC/logLik. If you concluded that this variable was a possible confounder, then keep it in the model.</p>
</section>
<section id="step-6.5-adding-an-interaction-term" class="level4">
<h4 class="anchored" data-anchor-id="step-6.5-adding-an-interaction-term">Step 6.5: Adding an interaction term</h4>
<p>We saw in <strong>Step 3.2</strong> that the effect of age on length of hospitalisation is modified by sex. We knew this because the slopes were different for males and females. Given this information add now to the model an interaction term between sex and age.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>An interaction can be written as a multiplication of two variables in your regression formula, e.g.&nbsp;age*sex. There is no need to keep both variables individually in the formula AND in the interaction term. By just including the interaction term, R will estimate the coefficients independently for both variables and with the interaction.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>hyper_hospd_adj_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(hospd <span class="sc">~</span> hyper <span class="sc">+</span> vac <span class="sc">+</span> mono <span class="sc">+</span> tick <span class="sc">+</span> other <span class="sc">+</span> age<span class="sc">*</span>sex, <span class="at">data =</span> tbe) <span class="co"># formula</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(hyper_hospd_adj_lm)                                <span class="co"># estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">24.2675847</td>
<td style="text-align: right;">1.6629366</td>
<td style="text-align: right;">14.5932114</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">hyperyes</td>
<td style="text-align: right;">2.9092258</td>
<td style="text-align: right;">1.1650411</td>
<td style="text-align: right;">2.4971014</td>
<td style="text-align: right;">0.0128588</td>
</tr>
<tr class="odd">
<td style="text-align: left;">vacyes</td>
<td style="text-align: right;">-9.0596630</td>
<td style="text-align: right;">2.3224314</td>
<td style="text-align: right;">-3.9009389</td>
<td style="text-align: right;">0.0001096</td>
</tr>
<tr class="even">
<td style="text-align: left;">monoyes</td>
<td style="text-align: right;">2.9451978</td>
<td style="text-align: right;">0.9064522</td>
<td style="text-align: right;">3.2491487</td>
<td style="text-align: right;">0.0012396</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tickyes</td>
<td style="text-align: right;">-0.6988387</td>
<td style="text-align: right;">0.9557594</td>
<td style="text-align: right;">-0.7311868</td>
<td style="text-align: right;">0.4650256</td>
</tr>
<tr class="even">
<td style="text-align: left;">otheryes</td>
<td style="text-align: right;">2.2322254</td>
<td style="text-align: right;">1.0235851</td>
<td style="text-align: right;">2.1807913</td>
<td style="text-align: right;">0.0296887</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">0.3998845</td>
<td style="text-align: right;">0.0293313</td>
<td style="text-align: right;">13.6333864</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">sexfemale</td>
<td style="text-align: right;">-3.0511594</td>
<td style="text-align: right;">2.5045520</td>
<td style="text-align: right;">-1.2182456</td>
<td style="text-align: right;">0.2237354</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age:sexfemale</td>
<td style="text-align: right;">-0.1728331</td>
<td style="text-align: right;">0.0499755</td>
<td style="text-align: right;">-3.4583541</td>
<td style="text-align: right;">0.0005924</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(hyper_hospd_adj_lm)                              <span class="co"># performance metrics</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.4860689</td>
<td style="text-align: right;">0.4774132</td>
<td style="text-align: right;">9.823278</td>
<td style="text-align: right;">56.15605</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-1788.045</td>
<td style="text-align: right;">3596.09</td>
<td style="text-align: right;">3637.911</td>
<td style="text-align: right;">45835.97</td>
<td style="text-align: right;">475</td>
<td style="text-align: right;">484</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<div class="webex-check">
QUESTION: Looking at the estimates of the model, for females, what is the net effect of age on length of hospitalisation?
<div id="radio_BNPGWAYRBT" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_BNPGWAYRBT" value=""> <span>+0.4</span></label><label><input type="radio" autocomplete="off" name="radio_BNPGWAYRBT" value="answer"> <span>+0.23</span></label><label><input type="radio" autocomplete="off" name="radio_BNPGWAYRBT" value=""> <span>-0.17</span></label><label><input type="radio" autocomplete="off" name="radio_BNPGWAYRBT" value=""> <span>+0.17</span></label><label><input type="radio" autocomplete="off" name="radio_BNPGWAYRBT" value=""> <span>-0.32</span></label>
</div>
</div>
<p>Looking at the results, we see that age has an estimate of 0.4, which means that one additional year of age is associated with an increase in 0.4 days of hospitalisation. We also see that being female is associated with a decrease in 3 days of hospitalisation (compared with being male). The interaction estimate of -0.17 means that for females, each additional year of age is associated with a decrease in 0.17 days of hospitalisation. So, to sum up, all things equal, a female of 41 years, compared to one of 40 years, would have +0.4 days of hospitalisation for having one extra year, but as she is female you have to add the interaction term (-0.17), so the net effect would be +0.23. For males, one extra year would still be associated with +0.4 days of hospitalisation.</p>
<p>We also see that adding the interaction term changes the effect estimate for hypertension and improves the model, so we may want to keep the interaction in the model, assuming that this ensures a better control for confounding of “age” and “sex”.</p>
<p><em>Note</em>: You should also look for other effect interaction terms in the dataframe. In the interest of the exercise, we will skip this step.</p>
</section>
</section>
<section id="step-7-model-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="step-7-model-diagnostics"><strong>Step 7: Model diagnostics</strong></h3>
<p>The multiple linear regression model that we just run, like all models, has several assumptions:</p>
<ol type="1">
<li><p><strong>Linearity</strong>: The relationship between the independent variables and the dependent variable (length of hospitalisation) is linear. This means that the change in the dependent variable is proportional to the change in the independent variables.</p></li>
<li><p><strong>Independence</strong>: The observations are independent of each other.</p></li>
<li><p><strong>Normality of Residuals</strong>: The residuals of the model are normally distributed, meaning that they are symmetrically distributed around 0 and the residuals’ distribution is bell-shaped.</p></li>
<li><p><strong>Homoscedasticity</strong>: The residuals (difference between the observed values and the values estimated from the model) have constant variance at every level of the independent variables. This means that the spread of the residuals should be roughly the same across all levels of the independent variables.</p></li>
<li><p><strong>No Multicollinearity</strong>: The independent variables are not highly correlated with each other. High multicollinearity can make it difficult to determine the individual effect of each independent variable on the dependent variable.</p></li>
<li><p><strong>No Autocorrelation</strong>: The residuals are not correlated with each other. This is particularly important in time series data where observations are ordered in time.</p></li>
</ol>
<p>In this case study we will learn how to check two of these assumptions: <strong>Normality of residuals</strong> and <strong>Homoscedasticity</strong></p>
<section id="step-7.1-normality-assumption" class="level4">
<h4 class="anchored" data-anchor-id="step-7.1-normality-assumption">Step 7.1: Normality assumption</h4>
<p>To assess whether the residuals of our model are normally distributed or not we will do these three things:</p>
<ul>
<li><p>Generating some diagnostic plots of the model</p></li>
<li><p>Creating an histogram with the residuals</p></li>
<li><p>Carrying out a Shapiro-test</p></li>
</ul>
<p><strong>Task</strong>: Generate diagnostic plots of the model <em>hyper_hospd_adj_lm</em>. Don’t worry if you don’t find out how to do these. If you struggle, have a look at the hint below.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>You can retrieve <strong>diagnostic plots</strong> by using the function <code>autoplot()</code> from {ggfortify}. Pass your model object to the <code>autoplot()</code> function to generate three basic diagnostic plots. You can also specify which plot <code>autoplot()</code> needs to generate using the which = argument. In the solution, we specify that we want the first 2 plots.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(hyper_hospd_adj_lm, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>Let’s interpret each graph:</p>
<ul>
<li><p><strong>Residuals vs.&nbsp;fitted plot (plot 1, upper left corner):</strong> You see a scatterplot with a blue line (LOESS smoothing curve). If the residuals are normally distributed around zero, then the blue line will be horizontal (parallel to the zero line).</p></li>
<li><p><strong>Q-Q plot (plot 2, upper right plot):</strong> The Q-Q plot shows you whether or not the residuals are normally distributed. On the X-axis you can see the quantiles of a normal distribution, while on the Y-axis you can see the standardized residuals (residuals dived by their standard deviation). If the residuals are normally distributed, in general, most of the points need to lie on the diagonal.</p></li>
</ul>
<div class="webex-check">
QUESTION: Are residuals normally distributed, based on these plots?
<div id="radio_KRKFQNZJCL" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_KRKFQNZJCL" value=""> <span>No</span></label><label><input type="radio" autocomplete="off" name="radio_KRKFQNZJCL" value="answer"> <span>Yes</span></label>
</div>
</div>
<p><strong>Task</strong>: Build an histogram with the residuals of the <em>hyper_hospd_adj_lm</em> model.</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>To do an <strong>histogram of the residuals</strong> you can follow a similar approach than the one we used in the <strong>step 6.3</strong>. That is, first adding to the <em>tbe</em> dataframe the residuals as a column (you can use the function <code>resid()</code>) and then using <code>ggplot()</code> to plot this column in the x-axis of a <code>geom_histogram()</code></p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First add a variable with the residual values to the dataframe</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>data_res <span class="ot">&lt;-</span> tbe <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(hospd)) <span class="sc">%&gt;%</span>   <span class="co"># Remove NAs </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">res =</span> <span class="fu">resid</span>(hyper_hospd_adj_lm)) <span class="co"># Create a new variable with the residual values</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="do">### You can now open data_res to have a look at the new column</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we do the histogram with the residuals</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>data_res <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> res)) <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..)) <span class="sc">+</span>                        <span class="co"># Adding a histogram with density</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#the function below will add the normal curve. </span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,  <span class="co">#The fun = argument we are specifying that we want the normal curve         </span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(data_res<span class="sc">$</span>res, <span class="at">na.rm =</span> T), <span class="co">#to draw a normal curve we need to give the mean and standard deviation of our column</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sd   =</span> <span class="fu">sd</span>(data_res<span class="sc">$</span>res, <span class="at">na.rm =</span> T)),  </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"darkblue"</span>, <span class="at">lwd =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Histogram of Residuals"</span>, </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()                                  <span class="co"># we add a predefined theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<div class="webex-check">
QUESTION: Does the histogram suggest a normal distribution of residuals?
<div id="radio_RUSVBMIVMF" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_RUSVBMIVMF" value=""> <span>No</span></label><label><input type="radio" autocomplete="off" name="radio_RUSVBMIVMF" value="answer"> <span>Yes</span></label>
</div>
</div>
<p><strong>Task</strong>: Carry out a Shapiro-Wilk test to ascertain statistically if residuals are normally distributed</p>
<details>
<summary style="text-decoration: underline; color: darkgreen;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:gold;overflow:visible;position:relative;"><path d="M297.2 248.9C311.6 228.3 320 203.2 320 176c0-70.7-57.3-128-128-128S64 105.3 64 176c0 27.2 8.4 52.3 22.8 72.9c3.7 5.3 8.1 11.3 12.8 17.7l0 0c12.9 17.7 28.3 38.9 39.8 59.8c10.4 19 15.7 38.8 18.3 57.5H109c-2.2-12-5.9-23.7-11.8-34.5c-9.9-18-22.2-34.9-34.5-51.8l0 0 0 0c-5.2-7.1-10.4-14.2-15.4-21.4C27.6 247.9 16 213.3 16 176C16 78.8 94.8 0 192 0s176 78.8 176 176c0 37.3-11.6 71.9-31.4 100.3c-5 7.2-10.2 14.3-15.4 21.4l0 0 0 0c-12.3 16.8-24.6 33.7-34.5 51.8c-5.9 10.8-9.6 22.5-11.8 34.5H226.4c2.6-18.7 7.9-38.6 18.3-57.5c11.5-20.9 26.9-42.1 39.8-59.8l0 0 0 0 0 0c4.7-6.4 9-12.4 12.7-17.7zM192 128c-26.5 0-48 21.5-48 48c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-44.2 35.8-80 80-80c8.8 0 16 7.2 16 16s-7.2 16-16 16zm0 384c-44.2 0-80-35.8-80-80V416H272v16c0 44.2-35.8 80-80 80z"></path></svg> Click to read a hint</p>
</summary>
<p><br></p>
<p>Review Step 4.1 and/or have a look at the EpiRhandbook Chapter on <a href="https://epirhandbook.com/new_pages/stat_tests.html">Simple statistical tests</a> if you still have doubts.</p>
<p><br></p>
</details>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data_res <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shapiro_test</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">res</td>
<td style="text-align: right;">0.9960796</td>
<td style="text-align: right;">0.2762974</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><br></p>
</details>
<div class="webex-check">
QUESTION: How do you interpret the result of the Shapiro-Wilk test?
<div id="radio_WUDALWYUPS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_WUDALWYUPS" value=""> <span>Residuals do not follow a normal distribution</span></label><label><input type="radio" autocomplete="off" name="radio_WUDALWYUPS" value="answer"> <span>We cannot reject the null hypothesis that residuals follow a normal distribution</span></label><label><input type="radio" autocomplete="off" name="radio_WUDALWYUPS" value=""> <span>We accept the alternative hypothesis</span></label>
</div>
</div>
</section>
<section id="step-7.2-homoscedasticity" class="level4">
<h4 class="anchored" data-anchor-id="step-7.2-homoscedasticity">Step 7.2: Homoscedasticity</h4>
<p>Now we will check the other assumption, that the variance of the residuals (i.e., the magnitude of their distance to 0) does not depend on the predictor.</p>
<p>Check homoscedasticity by running plot number 3 (Scale-location plot) in the <code>autoplot()</code> function.</p>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the scale-location plot</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(hyper_hospd_adj_lm, <span class="at">which =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="tbe_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</details>
<p>This plot is called a scale-location plot and represents the fitted values vs.&nbsp;the square root of the standardized residuals. With this plot it is possible to check for heteroscedasticity (i.e., heterogeneity of variance - the opposite of homoscedasticity). Ideally, the residuals should be <strong>evenly spread</strong> out across all levels of fitted values. This means there should be no clear pattern or systematic change in the spread of residuals as you move along the x-axis. If the residuals form a <strong>funnel shape</strong> (narrow at one end and wide at the other), this indicates heteroscedasticity, meaning the variance of the residuals is not constant. The <strong>blue smoothed line</strong> should be roughly horizontal and close to zero. Significant deviations from this line can indicate issues with homoscedasticity.</p>
<div class="webex-check">
QUESTION: Based on this graph, do you think that the assumption of homoscedasticity is reasonably met?
<div id="radio_SBPEDUSKNB" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_SBPEDUSKNB" value=""> <span>No</span></label><label><input type="radio" autocomplete="off" name="radio_SBPEDUSKNB" value="answer"> <span>Yes</span></label>
</div>
</div>
</section>
</section>
<section id="step-8-public-health-relevance" class="level3">
<h3 class="anchored" data-anchor-id="step-8-public-health-relevance"><strong>Step 8: Public health relevance</strong></h3>
<ul>
<li>Discuss the PH relevance of your findings and any next steps and recommendations that may result from this.</li>
</ul>
<details>
<summary style="text-decoration: underline; color: red;">
<p><svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"></path></svg>Click to see a solution (try it yourself first!)</p>
</summary>
<p><br></p>
<p>This is the first time that an association between hypertension and severity of TBE (based on the duration of hospitalisation) has been detected. Even though you suspected such an association in the beginning (and thus tested for it) and even though you think that it may be causal based on your DAGs and the control for confounding, there are more steps involved in establishing a causal relationship. We should follow the Bradford Hill Criteria to argue causality. For example, the biological basis for this effect needs to be established. Similar effects have been seen for other infections (e.g., SARS-CoV-2), which may have promoted the hypothesis in the beginning. You may also decide to look for a possible dose-response relationship in further analysis of our data. Furthermore, these results should be repeated independently to rule out a chance finding. Once the causal relationship between hypertension and TBE is further corroborated, vaccination against TBE for persons with hypertension could be recommended. <br></p>
</details>


</section>
</section>
</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>